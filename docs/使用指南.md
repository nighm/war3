# 魔兽争霸3地图开发使用指南

## 快速开始

### 1. 环境准备

#### 1.1 安装魔兽争霸3
- 确保已安装魔兽争霸3：混乱之治和冰封王座
- 推荐安装路径：`C:\Program Files\Warcraft III\`
- 确保World Editor可以正常启动

#### 1.2 安装Python环境
```bash
# 检查Python版本（需要3.8+）
python --version

# 创建虚拟环境
python -m venv venv

# 激活虚拟环境
# Windows:
venv\Scripts\activate
# Linux/Mac:
source venv/bin/activate

# 安装依赖
pip install -r requirements.txt
```

#### 1.3 配置开发环境
```bash
# 检查开发环境
python src/main.py --check-env

# 如果环境检查失败，请手动配置config/config.yaml文件
```

### 2. 创建新项目

#### 2.1 使用项目模板生成器
```bash
# 创建RPG地图项目
python scripts/create_project_template.py "我的RPG地图" --type rpg --author "你的名字" --description "一个有趣的RPG地图"

# 创建塔防地图项目
python scripts/create_project_template.py "我的塔防地图" --type td --author "你的名字" --description "一个刺激的塔防地图"

# 创建MOBA地图项目
python scripts/create_project_template.py "我的MOBA地图" --type moba --author "你的名字" --description "一个平衡的MOBA地图"
```

#### 2.2 项目类型说明
- **rpg**: 角色扮演游戏地图
- **td**: 塔防游戏地图
- **moba**: 多人在线战术竞技地图
- **survival**: 生存挑战类游戏地图
- **melee**: 传统即时战略对战地图

### 3. 项目结构

创建项目后，你会得到以下目录结构：

```
我的RPG地图/
├── README.md                 # 项目说明文档
├── project_config.yaml       # 项目配置文件
├── docs/                     # 文档目录
│   ├── design/              # 设计文档
│   └── api/                 # API文档
├── maps/                     # 地图文件目录
├── triggers/                 # 触发器代码目录
├── units/                    # 单位数据目录
├── items/                    # 物品数据目录
├── resources/                # 资源文件目录
│   ├── models/              # 模型文件
│   ├── textures/            # 贴图文件
│   ├── sounds/              # 音效文件
│   └── music/               # 音乐文件
├── scripts/                  # 脚本工具目录
├── backups/                  # 备份文件目录
├── logs/                     # 日志文件目录
├── tests/                    # 测试文件目录
└── exports/                  # 导出文件目录
```

## 开发流程

### 阶段1：概念设计

#### 1.1 确定地图类型
- 根据你的创意选择合适的地图类型
- 参考现有地图获取灵感
- 确定目标玩家群体

#### 1.2 设计游戏机制
- 核心玩法：游戏的主要玩法是什么？
- 胜利条件：玩家如何获胜？
- 失败条件：玩家如何失败？
- 资源系统：游戏中的资源如何获取和使用？

#### 1.3 绘制地图草图
- 地形布局：地图的整体地形设计
- 资源分布：重要资源的位置
- 建筑布局：关键建筑的位置
- 路径设计：单位移动路径

### 阶段2：地形制作

#### 2.1 启动World Editor
```bash
# 启动World Editor
python src/main.py --launch-editor world_editor

# 或者直接运行
# 找到你的魔兽争霸3安装目录
# 运行 World Editor.exe
```

#### 2.2 创建基础地形
1. 选择合适的地形类型（草地、雪地、沙漠等）
2. 绘制基础地形
3. 调整地形高度
4. 添加装饰物（树木、岩石等）

#### 2.3 设置玩家起始点
1. 放置玩家起始位置
2. 设置玩家颜色
3. 配置玩家控制类型

### 阶段3：单位设计

#### 3.1 创建自定义单位
1. 在World Editor中打开Object Editor
2. 选择要修改的单位类型
3. 调整单位属性：
   - 生命值
   - 攻击力
   - 护甲值
   - 移动速度
   - 攻击范围

#### 3.2 设计技能系统
1. 创建自定义技能
2. 设置技能效果
3. 调整技能平衡性
4. 测试技能效果

#### 3.3 平衡性调整
1. 测试单位在游戏中的表现
2. 调整数值确保平衡
3. 记录修改和测试结果

### 阶段4：触发器编程

#### 4.1 基础触发器
```jass
// 游戏初始化触发器
function InitGame takes nothing returns nothing
    // 设置游戏参数
    call SetGameSpeed( MAP_SPEED_FAST )
    
    // 初始化玩家数据
    call InitPlayerData()
    
    // 初始化游戏系统
    call InitGameSystems()
endfunction
```

#### 4.2 事件触发器
```jass
// 单位死亡事件
function OnUnitDeath takes nothing returns nothing
    local unit dyingUnit = GetDyingUnit()
    local player owner = GetOwningPlayer(dyingUnit)
    
    // 处理单位死亡逻辑
    call HandleUnitDeath(dyingUnit, owner)
endfunction
```

#### 4.3 胜利条件触发器
```jass
// 检查胜利条件
function CheckVictoryConditions takes nothing returns nothing
    local integer i = 0
    local boolean victory = false
    
    // 检查玩家是否达到胜利条件
    loop
        exitwhen i >= 8
        if GetPlayerController(Player(i)) == MAP_CONTROL_USER then
            if IsVictoryConditionMet(Player(i)) then
                set victory = true
                call Victory(Player(i))
            endif
        endif
        set i = i + 1
    endloop
endfunction
```

### 阶段5：测试优化

#### 5.1 功能测试
- [ ] 地图加载正常
- [ ] 单位创建正常
- [ ] 技能效果正常
- [ ] 触发器逻辑正常
- [ ] 胜利/失败条件正常

#### 5.2 平衡性测试
- [ ] 单位数值合理
- [ ] 技能平衡
- [ ] 资源获取合理
- [ ] 游戏节奏良好

#### 5.3 性能优化
- [ ] 地图文件大小合理
- [ ] 加载速度正常
- [ ] 游戏运行流畅
- [ ] 内存使用合理

### 阶段6：发布维护

#### 6.1 最终测试
1. 进行全面功能测试
2. 进行多人游戏测试
3. 收集玩家反馈
4. 修复发现的问题

#### 6.2 文件优化
1. 压缩地图文件
2. 清理无用资源
3. 优化文件结构
4. 创建发布版本

#### 6.3 发布地图
1. 上传到地图平台
2. 编写地图介绍
3. 提供游戏说明
4. 收集玩家反馈

## 高级功能

### 1. 使用JNGP进行高级开发

#### 1.1 安装JNGP
1. 下载JNGP工具包
2. 解压到魔兽争霸3目录
3. 运行JNGP.exe

#### 1.2 高级JASS编程
```jass
// 使用JNGP的高级功能
library AdvancedSystems
    // 自定义库函数
    function CreateCustomUnit takes player p, real x, real y returns unit
        local unit u = CreateUnit(p, 'hfoo', x, y, 270.0)
        call SetUnitAbilityLevel(u, 'A000', 1)
        return u
    endfunction
    
    // 自定义数据结构
    struct UnitData
        unit u
        real health
        real mana
    endstruct
endlibrary
```

### 2. 资源管理

#### 2.1 自定义模型
1. 准备3D模型文件
2. 转换为魔兽争霸3格式
3. 导入到地图中
4. 测试模型效果

#### 2.2 自定义贴图
1. 准备贴图文件
2. 转换为游戏格式
3. 应用到单位或建筑
4. 调整贴图效果

#### 2.3 自定义音效
1. 准备音效文件
2. 转换为游戏格式
3. 导入到地图中
4. 设置音效触发

### 3. 多人游戏开发

#### 3.1 网络同步
```jass
// 网络同步示例
function SyncPlayerData takes nothing returns nothing
    local integer i = 0
    loop
        exitwhen i >= 8
        if GetPlayerController(Player(i)) == MAP_CONTROL_USER then
            // 同步玩家数据到所有客户端
            call SyncInteger("PlayerGold", i, GetPlayerState(Player(i), PLAYER_STATE_RESOURCE_GOLD))
        endif
        set i = i + 1
    endloop
endfunction
```

#### 3.2 聊天系统
```jass
// 聊天系统示例
function HandleChat takes nothing returns nothing
    local string message = GetEventPlayerChatString()
    local player chatPlayer = GetTriggerPlayer()
    
    // 处理聊天消息
    if StringLength(message) > 0 then
        call DisplayTextToPlayer(GetLocalPlayer(), 0, 0, GetPlayerName(chatPlayer) + ": " + message)
    endif
endfunction
```

## 常见问题

### 1. 环境问题

**Q: World Editor无法启动**
A: 
1. 检查魔兽争霸3是否正确安装
2. 确保World Editor.exe存在
3. 以管理员身份运行
4. 检查系统兼容性

**Q: 地图文件过大**
A:
1. 压缩图片资源
2. 删除无用资源
3. 优化触发器代码
4. 使用地图优化工具

### 2. 开发问题

**Q: 触发器不工作**
A:
1. 检查触发器语法
2. 确保事件正确触发
3. 检查条件设置
4. 使用调试工具

**Q: 单位不平衡**
A:
1. 测试单位性能
2. 调整数值参数
3. 考虑单位配合
4. 收集玩家反馈

### 3. 发布问题

**Q: 地图无法上传**
A:
1. 检查地图文件格式
2. 确保文件大小合适
3. 验证地图完整性
4. 联系平台支持

## 学习资源

### 1. 官方资源
- 魔兽争霸3官方论坛
- 官方地图编辑器教程
- JASS脚本语言文档

### 2. 社区资源
- Hive Workshop：地图制作社区
- Warcraft3.info：技术文档
- YouTube教程视频

### 3. 推荐学习路径
1. **基础阶段**：掌握World Editor基本操作
2. **进阶阶段**：学习JASS脚本编程
3. **高级阶段**：掌握高级地图制作技巧
4. **专业阶段**：开发复杂的地图系统

## 开发工具推荐

### 1. 必需工具
- **World Editor**：官方地图编辑器
- **魔兽争霸3游戏**：测试环境

### 2. 推荐工具
- **JNGP**：增强的JASS编辑器
- **MPQ Editor**：资源文件管理
- **地图优化器**：性能优化工具

### 3. 可选工具
- **3D建模软件**：制作自定义模型
- **图像编辑软件**：制作自定义贴图
- **音频编辑软件**：制作自定义音效

---

**注意**: 本指南基于魔兽争霸3官方编辑器，请确保使用正版游戏文件进行开发。如有问题，请参考官方文档或社区资源。 